<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Linux on a T420 utilizing a dock and multiple monitors - Fabian's Website</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://0x0b.de/favicon.ico" rel="icon">

<link rel="canonical" href="https://0x0b.de/linux-on-a-t420-utilizing-a-dock-and-multiple-monitors.html">

        <meta name="author" content="Fabian Hirschmann" />
        <meta name="keywords" content="linux,t420,twinview,xinerama" />
        <meta name="description" content="This article is intended to document my efforts to set up (Debian) GNU/Linux on a Thinkpad T420 (with an nVidia GPU) utilizing a Docking Station which is connected to two Monitors via DVI. It was written in the hopes that it will be useful to people having similar setups ..." />

        <meta property="og:site_name" content="Fabian's Website" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Linux on a T420 utilizing a dock and multiple monitors"/>
        <meta property="og:url" content="https://0x0b.de/linux-on-a-t420-utilizing-a-dock-and-multiple-monitors.html"/>
        <meta property="og:description" content="This article is intended to document my efforts to set up (Debian) GNU/Linux on a Thinkpad T420 (with an nVidia GPU) utilizing a Docking Station which is connected to two Monitors via DVI. It was written in the hopes that it will be useful to people having similar setups ..."/>
        <meta property="article:published_time" content="2013-03-11" />
            <meta property="article:section" content="misc" />
            <meta property="article:tag" content="linux" />
            <meta property="article:tag" content="t420" />
            <meta property="article:tag" content="twinview" />
            <meta property="article:tag" content="xinerama" />
            <meta property="article:author" content="Fabian Hirschmann" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://0x0b.de/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="https://0x0b.de/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://0x0b.de/theme/css/pygments/monokai.css" rel="stylesheet">
    <link rel="stylesheet" href="https://0x0b.de/theme/css/style.css" type="text/css"/>


        <link href="https://0x0b.de/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Fabian's Website ATOM Feed"/>



        <link href="https://0x0b.de/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate"
              title="Fabian's Website misc ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://0x0b.de/" class="navbar-brand">
Fabian's Website            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://0x0b.de/pages/about-me.html">
                             About Me
                          </a></li>
                         <li><a href="https://0x0b.de/pages/projects.html">
                             Projects
                          </a></li>
                         <li><a href="https://0x0b.de/pages/publications.html">
                             Publications
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://0x0b.de/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://0x0b.de/linux-on-a-t420-utilizing-a-dock-and-multiple-monitors.html"
                       rel="bookmark"
                       title="Permalink to Linux on a T420 utilizing a dock and multiple monitors">
                        Linux on a T420 utilizing a dock and multiple monitors
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-03-11T11:40:00+01:00"> Mon 11 March 2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://0x0b.de/tag/linux.html">linux</a>
        /
	<a href="https://0x0b.de/tag/t420.html">t420</a>
        /
	<a href="https://0x0b.de/tag/twinview.html">twinview</a>
        /
	<a href="https://0x0b.de/tag/xinerama.html">xinerama</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This article is intended to document my efforts to set up (Debian) GNU/Linux
on a Thinkpad T420 (with an nVidia GPU) utilizing a Docking Station which is
connected to two Monitors via DVI. It was written in the hopes that it will
be useful to people having similar setups.</p>
<p>This setup utilizes the nVidia GPU to the fullest when docked without the
need for hacks like bumblebee.</p>
<h2>Multi-Monitor Setup (Twinview, Xinerama)</h2>
<p>The Thinkpad T420 comes in two variants: Variant A comes with a dedicated
nVidia GPU in addition to an Intel GPU, whilst Variant B ships with a Intel
GPU only. The following description <em>only</em> applies to Variant A.</p>
<p>When connecting the T420 to a docking station, the nVidia GPU is hardwired
to the two DVI outputs. This comes in handy because we don't need to worry
about rendering on a GPU that is not physically connected to an output,
which essentialy makes hacks like bumblebee superfluous.</p>
<h3>Configuring Xorg</h3>
<p>The approach I'm taking here involves having a single <code>xorg.conf</code> with
multiple layouts, and a small shell script which either picks the right
setup automatically (depending on whether you are docked), or lets you
decide. I found this to be more reasonable than having multiple xorg.conf
files that you'd otherwise have to synchronize each time you change
something. However, splitting the following configure file into several
files and using the include directive should work as well.</p>
<p>We'll start off with creating a single <code>xorg.conf</code> file:</p>
<div class="highlight"><pre>Section &quot;ServerFlags&quot;
    Option         &quot;DefaultServerLayout&quot; &quot;intel&quot;
    Option         &quot;DontZap&quot; &quot;off&quot;
    Option         &quot;BlankTime&quot; &quot;0&quot;
EndSection

### NVidia (Twinview) Configuration STARTS ###

Section &quot;ServerLayout&quot;
    Identifier     &quot;nvidiatwin&quot;
    Screen      0  &quot;nvidiatwin&quot; 0 0
EndSection

Section &quot;Device&quot;
    Identifier     &quot;nvidiatwin&quot;
    Driver         &quot;nvidia&quot;
    VendorName     &quot;NVIDIA Corporation&quot;
    BoardName      &quot;NVS 4200M&quot;
    BusID          &quot;PCI:1:0:0&quot;
    Option         &quot;NoLogo&quot; &quot;1&quot;
    Option         &quot;Coolbits&quot; &quot;1&quot;
EndSection

Section &quot;Screen&quot;
    Identifier     &quot;nvidiatwin&quot;
    Device         &quot;nvidiatwin&quot;
    Monitor        &quot;LG0&quot;
    DefaultDepth    24
    Option         &quot;TwinView&quot; &quot;1&quot;
    Option         &quot;TwinViewXineramaInfoOrder&quot; &quot;DFP-2&quot;
    Option         &quot;metamodes&quot; &quot;DFP-2: nvidia-auto-select +0+0, DFP-3: nvidia-auto-select +1680+0&quot;
    SubSection     &quot;Display&quot;
        Depth       24
    EndSubSection
EndSection

### NVidia (Dual-Screen) Configuration STARTS ###

Section &quot;ServerLayout&quot;
    Identifier     &quot;nvidia&quot;
    Screen      0  &quot;nvidia0&quot; 0 0
    Screen      1  &quot;nvidia1&quot; RightOf &quot;nvidia0&quot;
    Option         &quot;Xinerama&quot; &quot;1&quot;
EndSection

Section &quot;Device&quot;
    Identifier     &quot;nvidia0&quot;
    Driver         &quot;nvidia&quot;
    VendorName     &quot;NVIDIA Corporation&quot;
    BoardName      &quot;NVS 4200M&quot;
    BusID          &quot;PCI:1:0:0&quot;
    Option         &quot;NoLogo&quot; &quot;1&quot;
    Option         &quot;Coolbits&quot; &quot;1&quot;
    Screen         0
EndSection

Section &quot;Device&quot;
    Identifier     &quot;nvidia1&quot;
    Driver         &quot;nvidia&quot;
    VendorName     &quot;NVIDIA Corporation&quot;
    BoardName      &quot;NVS 4200M&quot;
    BusID          &quot;PCI:1:0:0&quot;
    Option         &quot;NoLogo&quot; &quot;1&quot;
    Option         &quot;Coolbits&quot; &quot;1&quot;
    Screen         1
EndSection

Section &quot;Screen&quot;
    Identifier     &quot;nvidia0&quot;
    Device         &quot;nvidia0&quot;
    Monitor        &quot;LG0&quot;
    DefaultDepth    24
    Option         &quot;TwinView&quot; &quot;0&quot;
    Option         &quot;metamodes&quot; &quot;DFP-2: nvidia-auto-select +0+0&quot;
    SubSection     &quot;Display&quot;
        Depth       24
    EndSubSection
EndSection

Section &quot;Screen&quot;
    Identifier     &quot;nvidia1&quot;
    Device         &quot;nvidia1&quot;
    Monitor        &quot;LG1&quot;
    DefaultDepth    24
    Option         &quot;TwinView&quot; &quot;0&quot;
    Option         &quot;TwinViewXineramaInfoOrder&quot; &quot;DFP-2&quot;
    Option         &quot;metamodes&quot; &quot;DFP-3: nvidia-auto-select +0+0&quot;
    Option         &quot;Rotate&quot; &quot;left&quot;
    SubSection     &quot;Display&quot;
        Depth       24
    EndSubSection
EndSection

Section &quot;Monitor&quot;
    Identifier     &quot;LG0&quot;
    VendorName     &quot;Unknown&quot;
    ModelName      &quot;LG Electronics L227W&quot;
    HorizSync       30.0 - 83.0
    VertRefresh     56.0 - 75.0
    Option         &quot;DPMS&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier     &quot;LG0&quot;
    VendorName     &quot;Unknown&quot;
    ModelName      &quot;LG Electronics L227W&quot;
    HorizSync       30.0 - 83.0
    VertRefresh     56.0 - 75.0
    Option         &quot;DPMS&quot;
EndSection


### NVidia Configuration ENDS ###

### Intel Configuration STARTS ###

Section &quot;ServerLayout&quot;
    Identifier     &quot;intel&quot;
    Screen      0  &quot;intel&quot; 0 0
EndSection

Section &quot;Device&quot;
    Identifier     &quot;intel&quot;
    Driver         &quot;intel&quot;
    Option         &quot;XvMC&quot; &quot;true&quot;
    Option         &quot;UseEvents&quot; &quot;true&quot;
    Option         &quot;AccelMethod&quot; &quot;UXA&quot;
    BusID          &quot;PCI:0:2:0&quot;
EndSection

Section &quot;Screen&quot;
    Identifier     &quot;intel&quot;
    Device         &quot;intel&quot;
    Monitor        &quot;INT&quot;
    DefaultDepth    24
    SubSection     &quot;Display&quot;
        Depth       24
    EndSubSection
EndSection

Section &quot;Monitor&quot;
    Identifier     &quot;INT&quot;
    VendorName     &quot;Unknown&quot;
    ModelName      &quot;Internal T420 Monitor&quot;
    HorizSync       30.0 - 83.0
    VertRefresh     56.0 - 75.0
EndSection

### Intel Configuration ENDS ###
</pre></div>


<p>Using this configuration file, you can switch between the following three layouts:</p>
<ul>
<li>Intel card only (<code>intel</code>): Layout you'd use when you are not connected to a dock</li>
<li>Twinview (<code>nvidiatwin</code>): Layout which sets up a single twinview screen spanning both monitors</li>
<li>Separate screens (<code>nvidia</code>): Layout with two xinerama-enabled screens</li>
</ul>
<p>You can now start your Xorg session by executing:</p>
<div class="highlight"><pre>startx -- -layout nvidiatwin -nolisten tcp
</pre></div>


<p>Please note the difference between dual screens utilizing xinerama and nVidia TwinView.
TwinView is a nvidia-only setup that creates one large desktop you can use to play games
that span both monitors for example. The other setup comprises of two separate screens
with xinerama enabled (so that you can drag a window from one monitor to the other).
The difference becomes obvious when you query the screen size using <code>xrandr</code>: The
TwinView setup will report one large screen, whilst the other setup will actually report
two screens.</p>
<p>This setup is however not very user-friendly. I created a little script called
<code>xorg-layout-chooser</code> using <code>dialog</code> which automatically detects your current setup:</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c"># Default mode when not conntected to a docking station</span>
<span class="nv">DEFUALT_LAYOUT</span><span class="o">=</span><span class="s2">&quot;intel&quot;</span>

<span class="c"># Default mode when conntected to a docking station</span>
<span class="nv">DEFAULT_LAYOUT_DOCKED</span><span class="o">=</span><span class="s2">&quot;nvidia&quot;</span>

<span class="c"># Timeout in seconds</span>
<span class="nv">TIMEOUT</span><span class="o">=</span>3

<span class="nv">LAYOUT_FILE</span><span class="o">=</span>/tmp/layout.mode

dialog --clear --timeout <span class="si">${</span><span class="nv">TIMEOUT</span><span class="si">}</span> <span class="se">\</span>
  --menu <span class="s2">&quot;Select xorg layout&quot;</span> <span class="m">12</span> <span class="m">70</span> <span class="m">5</span> <span class="se">\</span>
        <span class="s2">&quot;auto&quot;</span> <span class="s2">&quot;Auto-Detect&quot;</span> <span class="se">\</span>
        <span class="s2">&quot;intel&quot;</span> <span class="s2">&quot;Intel&quot;</span> <span class="se">\</span>
        <span class="s2">&quot;nvidiatwin&quot;</span> <span class="s2">&quot;nVidia TwinView&quot;</span> <span class="se">\</span>
        <span class="s2">&quot;nvidia&quot;</span> <span class="s2">&quot;Separate nVidia Screens&quot;</span> 2&gt;<span class="si">${</span><span class="nv">LAYOUT_FILE</span><span class="si">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="sb">`</span>cat <span class="si">${</span><span class="nv">LAYOUT_FILE</span><span class="si">}</span><span class="sb">`</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> <span class="sb">`</span>lsusb <span class="p">|</span> grep -q <span class="s2">&quot;Lenovo ThinkPad Mini Dock&quot;</span><span class="sb">`</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">LAYOUT</span><span class="o">=</span><span class="si">${</span><span class="nv">DEFAULT_LAYOUT_DOCKED</span><span class="si">}</span>
    <span class="k">else</span>
        <span class="nv">LAYOUT</span><span class="o">=</span><span class="si">${</span><span class="nv">DEFAULT_LAYOUT</span><span class="si">}</span>
    <span class="k">fi</span>
<span class="k">else</span>
    <span class="nv">LAYOUT</span><span class="o">=</span><span class="sb">`</span>cat <span class="si">${</span><span class="nv">LAYOUT_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="si">${</span><span class="nv">LAYOUT</span><span class="si">}</span>
</pre></div>


<p>If you use your shell rc files to start xorg, in my case <code>~/.zshrc</code>, you can now
change it to the following:</p>
<div class="highlight"><pre><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="k">$(</span>tty<span class="k">)</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;/dev/tty1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    startx -- -layout <span class="sb">`</span>xorg-layout-chooser<span class="sb">`</span> -nolisten tcp
<span class="k">fi</span>
</pre></div>


<p>As a result, you'll be presented the following dialog when logging in on <em>tty1</em>:</p>
<p><img alt="Layout chooser dialog" src="/images/xorg-chooser.png" /></p>
<h3>OpenGL</h3>
<p>Still, this setup may not work when OpenGL comes in. This is because, depending
on your distribution, the GLX link will point to the incorrect libraries. On
Debian, you can simply set the links using <code>update-alternatives</code>:</p>
<div class="highlight"><pre>update-alternatives --set glx /usr/lib/nvidia
</pre></div>


<p>For the Intel card, it is:</p>
<div class="highlight"><pre>update-alternatives --set glx /usr/lib/mesa-diverted
</pre></div>


<p>This can of course be integrated into the scripts mentioned above, possibly utilizing <code>sudo</code>.</p>
<p>On some distributions that don't provide a sophisticated alternatives system (such
as Arch Linux - last time I checked), you may be unable to switch the GLX libraries,
and the libraries of the driver that was installed last will be used.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = '0x0b'; // required: replace example with your forum shortname

                    var disqus_identifier = 'linux-on-a-t420-utilizing-a-dock-and-multiple-monitors';
                var disqus_url = 'https://0x0b.de/linux-on-a-t420-utilizing-a-dock-and-multiple-monitors.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
	<div class="container">
		<hr>
		<div class="row">
			<div class="col-xs-10">&copy; 2009 – 2015 Fabian Hirschmann
				&middot; <a href="https://0x0b.de/pages/legal-notice.html">legal notice</a>
				&middot; <a href="https://0x0b.de/pages/datenschutzerklarung.html">privacy statement</a>			</div>
			<div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
		</div>
		<div class="row pull-right">
			<ul class="list-group" id="social">
				<li class="list-group-item"><a href="https://github.com/fhirschmann"><i class="fa fa-github fa"></i> Github</a></li>
				<li class="list-group-item"><a href="mailto:fabian@hirschmann.email"><i class="fa fa-pencil fa"></i> Mail</a></li>
				<li class="list-group-item"><a href="http://www.facebook.com/fhirschmann"><i class="fa fa-facebook fa"></i> Facebook</a></li>
				<li class="list-group-item"><a href="http://www.linkedin.com/in/fhirschmann"><i class="fa fa-linkedin fa"></i> LinkedIn</a></li>
				<li class="list-group-item"><a href="https://www.xing.com/profile/Fabian_Hirschmann2"><i class="fa fa-xing fa"></i> Xing</a></li>
				<li class="list-group-item"><a href="bitcoin:16Mhwr5U9JVvVLEGwyPqyR1WE8qaJtzsin"><i class="fa fa-bitcoin fa"></i> BTC</a></li>
			</ul>
		</div>
	</div>
</footer>
<script src="https://0x0b.de/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://0x0b.de/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://0x0b.de/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = '0x0b'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>